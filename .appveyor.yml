image: Ubuntu2004

stack: jdk 11, docker

branches:
  only:
    - main

build: off

environment:
  matrix:
    - job_name: msql
    - job_name: psql

for:
  -
    matrix:
      only:
        - job_name: msql

    install:
      - docker compose down &
      - sleep 10s
      - docker compose up &
      - sleep 1m

    build_script:
      - chmod +x gradlew
      - ./gradlew clean test

  -
    matrix:
      only:
        - job_name: psql
        - job_depends_on: msql


    install:
      - docker compose down &
      - sleep 10s
      - docker compose up &
      - sleep 1m


    build_script:
      - chmod +x gradlew
      - ./gradlew clean test

